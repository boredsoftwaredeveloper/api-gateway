server:
  port: 8080

spring:
  application:
    name: api-gateway

  # Disable DataSource and Flyway in tests (no real DB needed)
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration
      - org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration

  cloud:
    gateway:
      server:
        webflux:
          globalcors:
            cors-configurations:
              '[/**]':
                allowed-origins:
                  - "http://localhost:4200"
                allowed-methods:
                  - GET
                  - POST
                  - PUT
                  - DELETE
                  - OPTIONS
                allowed-headers: "*"
                allow-credentials: true
                max-age: 3600

          routes:
            - id: profile-service
              uri: http://localhost:8081
              predicates:
                - Path=/api/v1/profiles/**,/api/v1/experiences/**,/api/v1/achievements/**,/api/v1/aspirations/**

            - id: regret-stream-service
              uri: http://localhost:8082
              predicates:
                - Path=/api/v1/feed/**

# Test Supabase config
supabase:
  url: http://localhost:9999
  anon-key: test-anon-key
  jwt:
    secret: test-secret-that-is-at-least-32-bytes-long

# Disable Swagger in tests
springdoc:
  api-docs:
    enabled: false
  swagger-ui:
    enabled: false

management:
  endpoints:
    web:
      exposure:
        include: health,info

resilience4j:
  circuitbreaker:
    configs:
      default:
        sliding-window-size: 10
        failure-rate-threshold: 50
        wait-duration-in-open-state: 5s
        permitted-number-of-calls-in-half-open-state: 3
  timelimiter:
    configs:
      default:
        timeout-duration: 5s

logging:
  level:
    org.springframework.cloud.gateway: DEBUG
